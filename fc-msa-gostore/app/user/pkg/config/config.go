package config

import "github.com/spf13/viper"

type Config struct {
	App struct {
		Name string `mapstructure:"name"`
		Host string `mapstructure:"host"`
		Port int    `mapstructure:"port"`
		Env  string `mapstructure:"env"`
	} `json:"app"`

	Logger struct {
		Level    string `mapstructure:"level"`    // Example: "info", "debug"
		Filepath string `mapstructure:"filepath"` // Example: "logs/account.log"
	} `mapstructure:"logger"`

	MongoDB struct {
		URI    string `mapstructure:"uri"`
		DbName string `mapstructure:"dbname"`
	} `mapstructure:"mongodb"`

	JWT struct {
		Secret string `mapstructure:"secret"`
		TTL    int    `mapstructure:"ttl"`
	} `mapstructure:"jwt"`
}

func NewConfig(filepath string) (*Config, error) {
	v := viper.New()
	v.SetConfigFile(filepath)

	if err := v.ReadInConfig(); err != nil {
		return nil, err
	}

	var cfg Config
	if err := v.Unmarshal(&cfg); err != nil {
		return nil, err
	}

	return &cfg, nil
}
